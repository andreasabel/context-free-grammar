language: haskell
ghc: 7.8

install:
  - travis_retry sudo add-apt-repository -y ppa:hvr/ghc
  - travis_retry sudo apt-get update
  - travis_retry sudo apt-get install cabal-install-1.18 ghc-$GHCVER happy-1.19.3
  - export PATH=/opt/happy/1.19.3/bin:/opt/ghc/$GHCVER/bin:$PATH

script:
  - cabal configure --enable-tests
  - cabal build
  - cabal test
  - cabal check
  - cabal sdist
  - export SRC_TGZ=$(cabal info . | awk '{print $2 ".tar.gz";exit}') ;
    cd dist/;
    if [ -f "$SRC_TGZ" ]; then
       cabal install --enable-tests "$SRC_TGZ";
    else
       echo "expected '$SRC_TGZ' not found";
       exit 1;
    fi